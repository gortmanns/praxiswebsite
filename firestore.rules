/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes rapid prototyping by focusing on authorization and skipping data validation.
 * It provides secure access control based on the assumption that all data is managed by authenticated users.
 *
 * Data Structure:
 * The database consists of four top-level collections: 'doctors', 'staff', 'medicalPartners', and 'otherPartners'.
 * There are no user-specific subcollections.
 *
 * Key Security Decisions:
 * - All read access is public.
 * - All write access is denied by default and requires an authenticated user.
 * - No data validation is performed in this prototype phase.
 * - `list` operations are public, assuming that the `hidden` property sufficiently controls visibility.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read access and authenticated-user-only write access to the 'doctors' collection.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (get, list): Any user can read doctor profiles.
     * @allow (create, update, delete): Only authenticated users can create, update, or delete doctor profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify doctor profiles.
     * @principle Allows public reads, protects writes to authenticated users.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants public read access and authenticated-user-only write access to the 'staff' collection.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (get, list): Any user can read staff member profiles.
     * @allow (create, update, delete): Only authenticated users can create, update, or delete staff member profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify staff member profiles.
     * @principle Allows public reads, protects writes to authenticated users.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants public read access and authenticated-user-only write access to the 'medicalPartners' collection.
     * @path /databases/{database}/documents/medicalPartners/{partnerId}
     * @allow (get, list): Any user can read medical partner profiles.
     * @allow (create, update, delete): Only authenticated users can create, update, or delete medical partner profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify medical partner profiles.
     * @principle Allows public reads, protects writes to authenticated users.
     */
    match /medicalPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants public read access and authenticated-user-only write access to the 'otherPartners' collection.
     * @path /databases/{database}/documents/otherPartners/{partnerId}
     * @allow (get, list): Any user can read other partner profiles.
     * @allow (create, update, delete): Only authenticated users can create, update, or delete other partner profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify other partner profiles.
     * @principle Allows public reads, protects writes to authenticated users.
     */
    match /otherPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }
  }

  // Helper function to determine if a user is signed in
  function isSignedIn() {
    return request.auth != null;
  }
}