/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict admin-only access model for all data.
 * All collections (doctors, staff, medicalPartners, otherPartners, holidays) and the banner settings
 * document are only accessible to authenticated administrators. There are no user-specific or public access
 * permissions defined.
 *
 * Data Structure:
 * The Firestore database consists of several top-level collections: `doctors`, `staff`,
 * `medicalPartners`, `otherPartners`, and `holidays`. There is also a single document at
 * `settings/banners` that contains banner configuration.
 *
 * Key Security Decisions:
 * - No public or user-specific data access is permitted.
 * - Only authenticated users can read or write data. A more sophisticated role system can be added later.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants admin-only access to the 'doctors' collection.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (get, list) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get, list) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /doctors/{doctorId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants admin-only access to the 'staff' collection.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (get, list) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get, list) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /staff/{staffId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants admin-only access to the 'medicalPartners' collection.
     * @path /databases/{database}/documents/medicalPartners/{partnerId}
     * @allow (get, list) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get, list) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /medicalPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants admin-only access to the 'otherPartners' collection.
     * @path /databases/{database}/documents/otherPartners/{partnerId}
     * @allow (get, list) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get, list) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /otherPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants admin-only access to the 'holidays' collection.
     * @path /databases/{database}/documents/holidays/{holidayId}
     * @allow (get, list) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get, list) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /holidays/{holidayId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants admin-only access to the 'settings/banners' document.
     * @path /databases/{database}/documents/settings/banners
     * @allow (get) If the user is authenticated.
     * @allow (create, update, delete) If the user is authenticated.
     * @deny (get) If the user is not authenticated.
     * @deny (create, update, delete) If the user is not authenticated.
     * @principle Enforces admin-only access, requiring authentication for all operations.
     */
    match /settings/banners {
      allow get: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}