/**
 * @file Firestore Security Rules
 * @description This ruleset allows unrestricted read access to all collections,
 *              while restricting write access to authenticated users only.
 *
 * Core Philosophy:
 *  - Open reads, authenticated writes.
 *
 * Data Structure:
 *  - Top-level collections: doctors, staff, serviceProviders, medicalPartners, otherPartners, holidays, infoBanners.
 *  - Single document settings/banners.
 *
 * Key Security Decisions:
 *  - Public listing is enabled for all collections.
 *  - Write access requires authentication.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to doctor profiles, restricts write access to authenticated users.
     * @path /doctors/{doctorId}
     * @allow (get, list): Any user can read doctor profiles.
     * @allow (create, update, delete): Only authenticated users can modify doctor profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify doctor profiles.
     * @principle: Open reads, authenticated writes.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to staff member profiles, restricts write access to authenticated users.
     * @path /staff/{staffId}
     * @allow (get, list): Any user can read staff member profiles.
     * @allow (create, update, delete): Only authenticated users can modify staff member profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify staff member profiles.
     * @principle: Open reads, authenticated writes.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to service provider profiles, restricts write access to authenticated users.
     * @path /serviceProviders/{serviceProviderId}
     * @allow (get, list): Any user can read service provider profiles.
     * @allow (create, update, delete): Only authenticated users can modify service provider profiles.
     * @deny (create, update, delete): Unauthenticated users cannot modify service provider profiles.
     * @principle: Open reads, authenticated writes.
     */
    match /serviceProviders/{serviceProviderId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to medical partner information, restricts write access to authenticated users.
     * @path /medicalPartners/{medicalPartnerId}
     * @allow (get, list): Any user can read medical partner information.
     * @allow (create, update, delete): Only authenticated users can modify medical partner information.
     * @deny (create, update, delete): Unauthenticated users cannot modify medical partner information.
     * @principle: Open reads, authenticated writes.
     */
    match /medicalPartners/{medicalPartnerId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to other partner information, restricts write access to authenticated users.
     * @path /otherPartners/{otherPartnerId}
     * @allow (get, list): Any user can read other partner information.
     * @allow (create, update, delete): Only authenticated users can modify other partner information.
     * @deny (create, update, delete): Unauthenticated users cannot modify other partner information.
     * @principle: Open reads, authenticated writes.
     */
    match /otherPartners/{otherPartnerId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to practice holiday periods, restricts write access to authenticated users.
     * @path /holidays/{holidayId}
     * @allow (get, list): Any user can read holiday information.
     * @allow (create, update, delete): Only authenticated users can modify holiday information.
     * @deny (create, update, delete): Unauthenticated users cannot modify holiday information.
     * @principle: Open reads, authenticated writes.
     */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to info banners, restricts write access to authenticated users.
     * @path /infoBanners/{infoBannerId}
     * @allow (get, list): Any user can read info banners.
     * @allow (create, update, delete): Only authenticated users can modify info banners.
     * @deny (create, update, delete): Unauthenticated users cannot modify info banners.
     * @principle: Open reads, authenticated writes.
     */
    match /infoBanners/{infoBannerId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to banner settings, restricts write access to authenticated users.
     * @path /settings/banners
     * @allow (get): Any user can read banner settings.
     * @allow (create, update, delete): Only authenticated users can modify banner settings.
     * @deny (create, update, delete): Unauthenticated users cannot modify banner settings.
     * @principle: Open reads, authenticated writes.
     */
    match /settings/banners {
      allow get: if true;
      allow create, update, delete: if isSignedIn();
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}