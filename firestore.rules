/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict admin-only access model for all data.
 * All collections (doctors, staff, medicalPartners, otherPartners, holidays) and the settings/banners document
 * are only accessible to authenticated administrators. There is no public read access.
 *
 * Data Structure:
 * - The database contains several top-level collections: `doctors`, `staff`, `medicalPartners`, `otherPartners`, and `holidays`.
 * - There is a single document at `settings/banners` which stores banner configuration.
 *
 * Key Security Decisions:
 * - No user listing is allowed.
 * - All write operations (create, update, delete) require authentication.
 * - Data validation is relaxed for prototyping purposes.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants admin-only access to the 'doctors' collection.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (get) Authenticated admin can read a doctor's profile.
     * @deny (get) Unauthenticated user cannot read a doctor's profile.
     * @allow (list) Authenticated admin can list doctors.
     * @deny (list) Unauthenticated user cannot list doctors.
     * @allow (create) Authenticated admin can create a doctor's profile.
     * @deny (create) Unauthenticated user cannot create a doctor's profile.
     * @allow (update) Authenticated admin can update a doctor's profile.
     * @deny (update) Unauthenticated user cannot update a doctor's profile.
     * @allow (delete) Authenticated admin can delete a doctor's profile.
     * @deny (delete) Unauthenticated user cannot delete a doctor's profile.
     * @principle Enforces admin-only access to doctor profiles.
     */
    match /doctors/{doctorId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants admin-only access to the 'staff' collection.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (get) Authenticated admin can read a staff member's profile.
     * @deny (get) Unauthenticated user cannot read a staff member's profile.
     * @allow (list) Authenticated admin can list staff members.
     * @deny (list) Unauthenticated user cannot list staff members.
     * @allow (create) Authenticated admin can create a staff member's profile.
     * @deny (create) Unauthenticated user cannot create a staff member's profile.
     * @allow (update) Authenticated admin can update a staff member's profile.
     * @deny (update) Unauthenticated user cannot update a staff member's profile.
     * @allow (delete) Authenticated admin can delete a staff member's profile.
     * @deny (delete) Unauthenticated user cannot delete a staff member's profile.
     * @principle Enforces admin-only access to staff member profiles.
     */
    match /staff/{staffId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants admin-only access to the 'medicalPartners' collection.
     * @path /databases/{database}/documents/medicalPartners/{partnerId}
     * @allow (get) Authenticated admin can read a medical partner's information.
     * @deny (get) Unauthenticated user cannot read a medical partner's information.
     * @allow (list) Authenticated admin can list medical partners.
     * @deny (list) Unauthenticated user cannot list medical partners.
     * @allow (create) Authenticated admin can create a medical partner's information.
     * @deny (create) Unauthenticated user cannot create a medical partner's information.
     * @allow (update) Authenticated admin can update a medical partner's information.
     * @deny (update) Unauthenticated user cannot update a medical partner's information.
     * @allow (delete) Authenticated admin can delete a medical partner's information.
     * @deny (delete) Unauthenticated user cannot delete a medical partner's information.
     * @principle Enforces admin-only access to medical partner information.
     */
    match /medicalPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants admin-only access to the 'otherPartners' collection.
     * @path /databases/{database}/documents/otherPartners/{partnerId}
     * @allow (get) Authenticated admin can read an other partner's information.
     * @deny (get) Unauthenticated user cannot read an other partner's information.
     * @allow (list) Authenticated admin can list other partners.
     * @deny (list) Unauthenticated user cannot list other partners.
     * @allow (create) Authenticated admin can create an other partner's information.
     * @deny (create) Unauthenticated user cannot create an other partner's information.
     * @allow (update) Authenticated admin can update an other partner's information.
     * @deny (update) Unauthenticated user cannot update an other partner's information.
     * @allow (delete) Authenticated admin can delete an other partner's information.
     * @deny (delete) Unauthenticated user cannot delete an other partner's information.
     * @principle Enforces admin-only access to other partner information.
     */
    match /otherPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

        /**
         * @description Grants admin-only access to the 'holidays' collection.
         * @path /databases/{database}/documents/holidays/{holidayId}
         * @allow (get) Authenticated admin can read a holiday period's information.
         * @deny (get) Unauthenticated user cannot read a holiday period's information.
         * @allow (list) Authenticated admin can list holiday periods.
         * @deny (list) Unauthenticated user cannot list holiday periods.
         * @allow (create) Authenticated admin can create a holiday period's information.
         * @deny (create) Unauthenticated user cannot create a holiday period's information.
         * @allow (update) Authenticated admin can update a holiday period's information.
         * @deny (update) Unauthenticated user cannot update a holiday period's information.
         * @allow (delete) Authenticated admin can delete a holiday period's information.
         * @deny (delete) Unauthenticated user cannot delete a holiday period's information.
         * @principle Enforces admin-only access to holiday information.
         */
    match /holidays/{holidayId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Grants admin-only access to the 'settings/banners' document.
     * @path /databases/{database}/documents/settings/banners
     * @allow (get) Authenticated admin can read the banner settings.
     * @deny (get) Unauthenticated user cannot read the banner settings.
     * @allow (list) Listing is not applicable for a single document.
     * @deny (list) Listing is not applicable for a single document.
     * @allow (create) Authenticated admin can create the banner settings.
     * @deny (create) Unauthenticated user cannot create the banner settings.
     * @allow (update) Authenticated admin can update the banner settings.
     * @deny (update) Unauthenticated user cannot update the banner settings.
     * @allow (delete) Authenticated admin can delete the banner settings.
     * @deny (delete) Unauthenticated user cannot delete the banner settings.
     * @principle Enforces admin-only access to banner settings.
     */
    match /settings/banners {
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}