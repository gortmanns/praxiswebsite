/**
 * @file Firestore Security Rules
 * @description This ruleset secures data for a practice website, focusing on content management.
 *
 * Core Philosophy:
 * All content collections (doctors, staff, partners, holidays, banner settings) are secured behind authentication.
 * Only authenticated users can create, update, or delete content.  Read access is public by default to facilitate website display.
 *
 * Data Structure:
 * The Firestore database consists of several top-level collections:
 * - /doctors: Doctor profiles.
 * - /staff: Staff member profiles.
 * - /medicalPartners: Medical partner information.
 * - /otherPartners: Other partner information.
 * - /holidays: Practice holiday periods.
 * - /settings/banners: Banner settings. This is a single document within the `settings` collection.
 *
 * Key Security Decisions:
 * - Public Read Access: Read (get, list) access is open to all for all collections, enabling the website to display the data.
 * - Authenticated Write Access: Write operations (create, update, delete) require authentication to prevent unauthorized modification of content.
 * - No User Roles: The rules do not implement user roles or granular permissions beyond authentication. Any logged-in user can modify any content.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secures the /doctors collection, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (get, list): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Secures the /staff collection, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (get, list): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Secures the /medicalPartners collection, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/medicalPartners/{partnerId}
     * @allow (get, list): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /medicalPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Secures the /otherPartners collection, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/otherPartners/{partnerId}
     * @allow (get, list): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /otherPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Secures the /holidays collection, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/holidays/{holidayId}
     * @allow (get, list): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Secures the /settings/banners document, allowing public reads but requiring authentication for writes.
     * @path /databases/{database}/documents/settings/banners
     * @allow (get): Allows any user (or no user) to read the data.
     * @allow (create, update, delete): Allows any authenticated user to modify data.
     * @deny (create, update, delete): Denies unauthenticated users from modifying data.
     * @principle Allows all users to read, but only authenticated users to write.
     */
    match /settings/banners {
        allow get: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }


    // catch-all rule for any other document
    match /{document=**} {
      allow read, write: if false;
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}