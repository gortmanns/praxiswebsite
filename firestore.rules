/**
 * @file Firestore Security Rules
 * @description This ruleset is designed for the practice website, enforcing a public-read, owner-write model for most content.
 *
 * Data Structure:
 * - Top-level collections: `doctors`, `staff`, `medicalPartners`, `otherPartners`, `holidays`.
 * - Singleton document: `settings/banners`.
 *
 * Key Security Decisions:
 * - Public Read: All top-level collections are readable by anyone.
 * - Owner-Only Writes: Create, update, and delete operations are restricted to authenticated users.
 * - Singleton Write Restriction:  The `settings/banners` document can be updated only by an authenticated user.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read the list of info banners.
     * @path /databases/{database}/documents/infoBanners
     * @allow (get, list): Any user can read the info banners.
     * @deny (create, update, delete): No one can create, update, or delete info banners directly.
     * @principle Public read access for info banners.
     */
    match /infoBanners/{infoBannerId} {
        allow get, list: if true;
        allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read the list of doctors. Only authenticated users can create, update, or delete doctors.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (get, list): Any user can read the doctors.
     * @allow (create): Only authenticated users can create doctors.
     * @allow (update, delete): Only authenticated users can update or delete existing doctors.
     * @deny (create): Denies creation if the user is not authenticated.
     * @deny (update, delete): Denies update or deletion if the document doesn't exist.
     * @principle Public read access with owner-only writes for doctors.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read the list of staff members. Only authenticated users can create, update, or delete staff members.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (get, list): Any user can read the staff members.
     * @allow (create): Only authenticated users can create staff members.
     * @allow (update, delete): Only authenticated users can update or delete existing staff members.
     * @deny (create): Denies creation if the user is not authenticated.
     * @deny (update, delete): Denies update or deletion if the document doesn't exist.
     * @principle Public read access with owner-only writes for staff members.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read the list of medical partners. Only authenticated users can create, update, or delete medical partners.
     * @path /databases/{database}/documents/medicalPartners/{partnerId}
     * @allow (get, list): Any user can read the medical partners.
     * @allow (create): Only authenticated users can create medical partners.
     * @allow (update, delete): Only authenticated users can update or delete existing medical partners.
     * @deny (create): Denies creation if the user is not authenticated.
     * @deny (update, delete): Denies update or deletion if the document doesn't exist.
     * @principle Public read access with owner-only writes for medical partners.
     */
    match /medicalPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read the list of other partners. Only authenticated users can create, update, or delete other partners.
     * @path /databases/{database}/documents/otherPartners/{partnerId}
     * @allow (get, list): Any user can read the other partners.
     * @allow (create): Only authenticated users can create other partners.
     * @allow (update, delete): Only authenticated users can update or delete existing other partners.
     * @deny (create): Denies creation if the user is not authenticated.
     * @deny (update, delete): Denies update or deletion if the document doesn't exist.
     * @principle Public read access with owner-only writes for other partners.
     */
    match /otherPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read the list of holidays. Only authenticated users can create, update, or delete holidays.
     * @path /databases/{database}/documents/holidays/{holidayId}
     * @allow (get, list): Any user can read the holidays.
     * @allow (create): Only authenticated users can create holidays.
     * @allow (update, delete): Only authenticated users can update or delete existing holidays.
     * @deny (create): Denies creation if the user is not authenticated.
     * @deny (update, delete): Denies update or deletion if the document doesn't exist.
     * @principle Public read access with owner-only writes for holidays.
     */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Restricts write access to the banner settings document to authenticated users. Read access is public.
     * @path /databases/{database}/documents/settings/banners
     * @allow (get): Any user can read the banner settings.
     * @allow (update): Only authenticated users can update the banner settings document if it exists.
     * @deny (create, delete): No one can create or delete the banner settings document.
     * @principle Owner-only writes for settings.
     */
    match /settings/banners {
        allow get: if true;
        allow create: if false;
        allow update: if isSignedIn() && resource != null;
        allow delete: if false;
    }

  }

  // Helper function to determine if the user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}