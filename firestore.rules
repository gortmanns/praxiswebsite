/**
 * @file Firebase Security Rules for Firestore.
 *
 * @core_philosophy This ruleset secures access to the Firestore database by allowing public read access to most collections
 *   but restricting write access to authenticated users only.  This is suitable for a public-facing site where content
 *   is managed through a separate admin interface.
 *
 * @data_structure The database consists of several top-level collections: `doctors`, `staff`, `medicalPartners`,
 *   `otherPartners`, `holidays`, and a single document `settings/banners`. All collections are treated as public-readable.
 *
 * @key_security_decisions
 *   - Public read access for all collections except `/settings/banners`.
 *   - Write access restricted to authenticated users. No role-based access control is implemented in this prototype.
 *   - No data validation beyond checking that `request.auth` is not null for write operations.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows anyone to read doctor profiles, but only authenticated users to create, update, or delete them.
     * @path /doctors/{doctorId}
     * @allow (get, list): Anyone can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (create, update, delete): Requests without authentication will be rejected.
     * @principle Public read, authenticated-user-only writes.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read staff member profiles, but only authenticated users to create, update, or delete them.
     * @path /staff/{staffId}
     * @allow (get, list): Anyone can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (create, update, delete): Requests without authentication will be rejected.
     * @principle Public read, authenticated-user-only writes.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read medical partner information, but only authenticated users to create, update, or delete them.
     * @path /medicalPartners/{partnerId}
     * @allow (get, list): Anyone can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (create, update, delete): Requests without authentication will be rejected.
     * @principle Public read, authenticated-user-only writes.
     */
    match /medicalPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read other partner information, but only authenticated users to create, update, or delete them.
     * @path /otherPartners/{partnerId}
     * @allow (get, list): Anyone can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (create, update, delete): Requests without authentication will be rejected.
     * @principle Public read, authenticated-user-only writes.
     */
    match /otherPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows anyone to read holiday information, but only authenticated users to create, update, or delete them.
     * @path /holidays/{holidayId}
     * @allow (get, list): Anyone can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (create, update, delete): Requests without authentication will be rejected.
     * @principle Public read, authenticated-user-only writes.
     */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Restricts access to the banner settings document to authenticated users only.
     * @path /settings/banners
     * @allow (get): Only authenticated users can read the data.
     * @allow (create, update, delete): Only authenticated users can modify the data.
     * @deny (get, create, update, delete): Requests without authentication will be rejected.
     * @principle Requires authentication for all operations.
     */
    match /settings/banners {
        allow get: if isSignedIn();
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }
  }
}