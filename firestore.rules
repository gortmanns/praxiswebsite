/**
 * @fileoverview Firestore Security Rules for Praxis Online.
 *
 * Core Philosophy:
 * This ruleset prioritizes a secure-by-default posture, restricting write access to specific roles or conditions while allowing public read access where appropriate.
 *
 * Data Structure:
 * The database consists of three top-level collections: `doctor_profiles`, `contact_form_submissions`, and `symptom_checks`. Each collection stores a specific entity type.
 *
 * Key Security Decisions:
 * - Doctor profiles are publicly readable, but write access is restricted.
 * - Contact form submissions have restricted write access, presumably for admin use only.
 * - Symptom checks are publicly readable, but write access is restricted.
 * - No user listing is allowed unless explicitly stated otherwise.
 *
 * Denormalization for Authorization:
 *  This ruleset does not currently implement denormalization, but it could be used for more complex authorization logic in the future (e.g., storing a list of authorized admin UIDs directly in the `contact_form_submissions` collection).
 *
 * Structural Segregation:
 * The use of separate top-level collections for each entity type (doctor profiles, contact form submissions, symptom checks) provides structural segregation.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to doctor profiles, but restricts write access.
     * @path /doctor_profiles/{doctorProfileId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @deny create: if true; // Example of how to deny an operation
     * @principle Public read, restricted write.
     */
    match /doctor_profiles/{doctorProfileId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Restricts write access to contact form submissions, allowing only authenticated users.
     * @path /contact_form_submissions/{contactFormSubmissionId}
     * @allow get: if false;
     * @allow list: if false;
     * @allow create: if isSignedIn();
     * @allow update: if false;
     * @allow delete: if false;
     * @deny create: if true; // Example of how to deny an operation
     * @principle Restricts write access to authenticated users.
     */
    match /contact_form_submissions/{contactFormSubmissionId} {
      allow get, list: if false;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows public read access to symptom checks, but restricts write access.
     * @path /symptom_checks/{symptomCheckId}
     * @allow get, list: if true;
     * @allow create: if false;
     * @allow update: if false;
     * @allow delete: if false;
     * @deny create: if true; // Example of how to deny an operation
     * @principle Public read, restricted write.
     */
    match /symptom_checks/{symptomCheckId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}