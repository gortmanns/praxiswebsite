/**
 * @fileoverview Firestore Security Rules for the application.
 *
 * Core Philosophy:
 * This ruleset enforces a strict editor-only access model for all data.
 * Only authenticated users can manage content.
 *
 * Data Structure:
 * All data is stored in top-level collections:
 * /doctors: Stores doctor profiles.
 * /staff: Stores staff member profiles.
 * /serviceProviders: Stores service provider profiles.
 * /medicalPartners: Stores medical partner information.
 * /otherPartners: Stores other partner information.
 * /holidays: Stores holiday periods.
 * /infoBanners: Stores info banners.
 * /settings/banners: Stores settings for holiday banners.
 *
 * Key Security Decisions:
 * - All collections are secured with editor-only access.
 * - Data shape validation is not performed beyond ownership checks.
 *
 * Access Control Pattern: Editor-Only Access
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages access to doctor profiles.
     * @path /databases/{database}/documents/doctors/{doctorId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for doctors collection.
     */
    match /doctors/{doctorId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to staff member profiles.
     * @path /databases/{database}/documents/staff/{staffId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for staff collection.
     */
    match /staff/{staffId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

     /**
     * @description Manages access to service provider profiles.
     * @path /databases/{database}/documents/serviceProviders/{serviceProviderId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for serviceProviders collection.
     */
    match /serviceProviders/{serviceProviderId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to medical partner information.
     * @path /databases/{database}/documents/medicalPartners/{medicalPartnerId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for medicalPartners collection.
     */
    match /medicalPartners/{medicalPartnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to other partner information.
     * @path /databases/{database}/documents/otherPartners/{otherPartnerId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for otherPartners collection.
     */
    match /otherPartners/{otherPartnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to holiday periods.
     * @path /databases/{database}/documents/holidays/{holidayId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for holidays collection.
     */
    match /holidays/{holidayId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to info banners.
     * @path /databases/{database}/documents/infoBanners/{infoBannerId}
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for infoBanners collection.
     */
    match /infoBanners/{infoBannerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages access to banner settings.
     * @path /databases/{database}/documents/settings/banners
     * @allow (create, update, delete) Authenticated user can manage.
     * @allow (get, list) Authenticated user can read.
     * @deny (create, update, delete) Unauthorized user attempts to write.
     * @deny (get, list) Unauthorized user attempts to read.
     * @principle Editor-only access for banner settings document.
     */
    match /settings/banners {
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}