/**
 * @fileoverview Firestore Security Rules for the practice data model.
 *
 * Core Philosophy:
 * This ruleset adopts a public read, owner-only write model. All data is readable by any client,
 * but write access (create, update, delete) is restricted to authenticated users.
 * There is no concept of user roles or shared data access in this model.
 *
 * Data Structure:
 * The Firestore database consists of several top-level collections: `doctors`, `staff`, `medicalPartners`,
 * `otherPartners`, `holidays`, and `infoBanners`. Additionally, a single document at `settings/banners` stores banner settings.
 *
 * Key Security Decisions:
 * - Public Read: All collections are publicly readable to facilitate easy data consumption in the application.
 * - Owner-Only Writes: All write operations require authentication.
 * - No User Listing: There is no dedicated user collection, and user listing is therefore not applicable.
 * - Denormalization: These rules assume that each document contains all information required for
 *   authorization. There are no cross-collection `get()` calls in the rules.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access and owner-only write access to doctor profiles.
     * @path /doctors/{doctorId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access and owner-only write access to staff member profiles.
     * @path /staff/{staffId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /staff/{staffId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access and owner-only write access to medical partner information.
     * @path /medicalPartners/{partnerId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /medicalPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access and owner-only write access to other partner information.
     * @path /otherPartners/{partnerId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /otherPartners/{partnerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

     /**
      * @description Allows public read access and owner-only write access to holiday information.
      * @path /holidays/{holidayId}
      * @allow (get, list): if true
      * @allow (create): if isSignedIn()
      * @allow (update, delete): if isSignedIn()
      * @deny (create): if !isSignedIn()
      * @deny (update, delete): if !isSignedIn()
      * @principle Allows public read access and restricts write access to authenticated users.
      */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access and owner-only write access to info banner information.
     * @path /infoBanners/{bannerId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /infoBanners/{bannerId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access and owner-only write access to banner settings.
     * @path /settings/banners
     * @allow (get): if true
     * @allow (create): if isSignedIn()
     * @allow (update, delete): if isSignedIn()
     * @allow (list): if false;
     * @deny (create): if !isSignedIn()
     * @deny (update, delete): if !isSignedIn()
     * @principle Allows public read access and restricts write access to authenticated users.
     */
    match /settings/banners {
        allow get: if true;
        allow list: if false;
        allow create: if isSignedIn();
        allow update: if isSignedIn() && resource != null;
        allow delete: if isSignedIn() && resource != null;
    }

  }

  function isSignedIn() {
    return request.auth != null;
  }
}