/**
 * @fileoverview Firestore Security Rules for Praxis Online.
 *
 * Core Philosophy:
 * This ruleset prioritizes simplicity and security. It assumes open read access where explicitly stated or no security requirements are given, and it enforces strict authorization for write operations, requiring administrative privileges.
 *
 * Data Structure:
 * The database consists of three top-level collections: `doctor_profiles`, `contact_form_submissions`, and `symptom_checks`.
 *
 * Key Security Decisions:
 * - Public read access is enabled for `doctor_profiles` due to the absence of specific authorization requirements.
 * - Write access to `contact_form_submissions` is denied to client, as submissions should be managed via backend, implying admin access.
 * - Read and write access to `symptom_checks` is public since no authorization requirements were specified.
 * - Listing all documents in the `contact_form_submissions` collection is disallowed because this is a high security risk.
 *
 * Denormalization for Authorization:
 * This ruleset avoids denormalization in favor of simplicity. More complex access control scenarios would benefit from embedding access control data directly within documents.
 *
 * Structural Segregation:
 * Each entity type has its own top-level collection, ensuring clear separation of concerns.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read doctor profiles. Write operations are disallowed.
     * @path /doctor_profiles/{doctorProfileId}
     * @allow (get, list) - Any user can read the profile of a doctor.
     * @deny (create, update, delete) - No client should be able to create, update, or delete doctor profiles.
     * @principle Open read access for public doctor information; write access managed via backend.
     */
    match /doctor_profiles/{doctorProfileId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to contact form submissions. No client should be able to create, update, delete or list form submissions.
     * @path /contact_form_submissions/{contactFormSubmissionId}
     * @allow None. No operation from client side is permitted
     * @deny (create, update, delete) - All write operations are denied to client-side requests.
     * @principle Only backend should create contact form submissions.
     */
    match /contact_form_submissions/{contactFormSubmissionId} {
      allow get: if false;
      allow list: if false;
      allow create, update, delete: if false;
    }

   /**
     * @description Allows anyone to create, read or delete symptom checks.
     * @path /symptom_checks/{symptomCheckId}
     * @allow (get, list, create, update, delete) - Any user can create, read, list and delete symptom checks.
     * @principle Open access for symptom checks.
     */
    match /symptom_checks/{symptomCheckId} {
        allow get, list, create, update, delete: if true;
    }
  }
}