/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes security by enforcing authentication for all write operations.
 * Read operations are generally open to allow easy data access during prototyping.
 * Data shape validation is relaxed to facilitate rapid schema iteration.
 *
 * Data Structure:
 * The database consists of several top-level collections: `doctors`, `staff`, `medicalPartners`,
 * `otherPartners`, `holidays`, and a single document at `settings/banners`.
 *
 * Key Security Decisions:
 * - All write operations (create, update, delete) require authentication (`isSignedIn()`).
 * - Read operations are generally allowed for all users (`allow get, list: if true;`),
 *   making the data publicly readable.
 * - No validation of data types or required fields is performed, except for critical authorization
 *   fields, such as the `id` field to ensure consistency within user-scoped paths.
 * - There is no user-specific data.
 *
 * Denormalization for Authorization: N/A (no user-specific data).
 * Structural Segregation: N/A (no distinction between public/private data).
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read access and requires authentication for all write operations on doctor profiles.
     * @path /doctors/{doctorId}
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /doctors/{doctorId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants public read access and requires authentication for all write operations on staff member profiles.
     * @path /staff/{staffMemberId}
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /staff/{staffMemberId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants public read access and requires authentication for all write operations on medical partner information.
     * @path /medicalPartners/{medicalPartnerId}
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /medicalPartners/{medicalPartnerId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants public read access and requires authentication for all write operations on other partner information.
     * @path /otherPartners/{otherPartnerId}
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /otherPartners/{otherPartnerId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants public read access and requires authentication for all write operations on holiday periods.
     * @path /holidays/{holidayId}
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /holidays/{holidayId} {
        allow get, list: if true;
        allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants public read access and requires authentication for all write operations on banner settings.
     * @path /settings/banners
     * @allow (get, list): Any user can read the data.
     * @allow (create, update, delete): Only authenticated users can modify data.
     * @deny (create, update, delete): Unauthenticated users cannot write data.
     * @principle Requires authentication for writes.
     */
    match /settings/banners {
        allow get, list: if true;
        allow create, update, delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}