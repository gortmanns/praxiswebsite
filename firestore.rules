/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict authentication-based access control model.
 * Only authenticated users are allowed to read or write data.
 *
 * Data Structure:
 * The database consists of several top-level collections: `doctors`, `staff`, `medicalPartners`, `otherPartners`, `holidays`, and `settings/banners`.
 *
 * Key Security Decisions:
 * - All data access requires authentication.
 * - All collections are writeable by authenticated users.
 * - The 'banners' document is in a `settings` collection, which should only ever contain one document.
 *
 * Data Denormalization: N/A - Not applicable for this authentication-only ruleset.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Grants access to the 'doctors' collection for authenticated users.
     * @path /doctors/{doctorId}
     * @allow (get, list) Authenticated user can read doctor profile.
     * @allow (create) Authenticated user can create doctor profile.
     * @allow (update) Authenticated user can update doctor profile.
     * @allow (delete) Authenticated user can delete doctor profile.
     * @deny (get, list) Unauthenticated user cannot read doctor profiles.
     * @deny (create, update, delete) Unauthenticated user cannot write doctor profiles.
     * @principle Allows authenticated users to manage doctor profiles.
     */
    match /doctors/{doctorId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants access to the 'staff' collection for authenticated users.
     * @path /staff/{staffId}
     * @allow (get, list) Authenticated user can read staff profile.
     * @allow (create) Authenticated user can create staff profile.
     * @allow (update) Authenticated user can update staff profile.
     * @allow (delete) Authenticated user can delete staff profile.
     * @deny (get, list) Unauthenticated user cannot read staff profiles.
     * @deny (create, update, delete) Unauthenticated user cannot write staff profiles.
     * @principle Allows authenticated users to manage staff profiles.
     */
    match /staff/{staffId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants access to the 'medicalPartners' collection for authenticated users.
     * @path /medicalPartners/{partnerId}
     * @allow (get, list) Authenticated user can read medical partner info.
     * @allow (create) Authenticated user can create medical partner info.
     * @allow (update) Authenticated user can update medical partner info.
     * @allow (delete) Authenticated user can delete medical partner info.
     * @deny (get, list) Unauthenticated user cannot read medical partner info.
     * @deny (create, update, delete) Unauthenticated user cannot write medical partner info.
     * @principle Allows authenticated users to manage medical partner information.
     */
    match /medicalPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants access to the 'otherPartners' collection for authenticated users.
     * @path /otherPartners/{partnerId}
     * @allow (get, list) Authenticated user can read other partner info.
     * @allow (create) Authenticated user can create other partner info.
     * @allow (update) Authenticated user can update other partner info.
     * @allow (delete) Authenticated user can delete other partner info.
     * @deny (get, list) Unauthenticated user cannot read other partner info.
     * @deny (create, update, delete) Unauthenticated user cannot write other partner info.
     * @principle Allows authenticated users to manage other partner information.
     */
    match /otherPartners/{partnerId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants access to the 'holidays' collection for authenticated users.
     * @path /holidays/{holidayId}
     * @allow (get, list) Authenticated user can read holiday info.
     * @allow (create) Authenticated user can create holiday info.
     * @allow (update) Authenticated user can update holiday info.
     * @allow (delete) Authenticated user can delete holiday info.
     * @deny (get, list) Unauthenticated user cannot read holiday info.
     * @deny (create, update, delete) Unauthenticated user cannot write holiday info.
     * @principle Allows authenticated users to manage holiday information.
     */
    match /holidays/{holidayId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Grants access to the 'banners' document under the 'settings' collection for authenticated users.
     * @path /settings/banners
     * @allow (get) Authenticated user can read banner settings.
     * @allow (create) Authenticated user can create banner settings.
     * @allow (update) Authenticated user can update banner settings.
     * @allow (delete) Authenticated user can delete banner settings.
     * @deny (get) Unauthenticated user cannot read banner settings.
     * @deny (create, update, delete) Unauthenticated user cannot write banner settings.
     * @principle Allows authenticated users to manage banner settings.
     */
    match /settings/banners {
      allow get: if isSignedIn();
      allow list: if false; // There is only 1 banner document, so listing this collection doesn't make sense.
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}